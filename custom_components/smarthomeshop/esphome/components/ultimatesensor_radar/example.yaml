# =============================================================================
# ULTIMATESENSOR MINI - MET CUSTOM COMPONENT (VOORBEELD)
# =============================================================================
# Dit is hoe de YAML eruit ziet met het custom component
# Vergelijk met de 1800+ regels in de huidige us-mini-esphomecode.yaml!
# =============================================================================

substitutions:
  device_name: "ultimatesensor-mini"
  friendly_name: "UltimateSensor Mini"

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}

esp32:
  board: esp32-s3-devkitc-1
  variant: esp32s3
  framework:
    type: arduino

# Laad het custom component van GitHub
external_components:
  - source: github://smarthomeshop/esphome-ultimatesensor
    components: [ultimatesensor_radar]

logger:
api:
ota:
  - platform: esphome

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

# UART voor LD2450 radar
uart:
  id: uart_radar
  tx_pin: GPIO13
  rx_pin: GPIO14
  baud_rate: 256000
  parity: NONE
  stop_bits: 1

# =============================================================================
# ULTIMATESENSOR RADAR COMPONENT
# =============================================================================
# Alles in één schone configuratie!
ultimatesensor_radar:
  id: radar
  uart_id: uart_radar
  max_distance: 6000
  installation_angle: 0
  invert_x: false

  # Entry/exit detection - detecteert of iemand echt de kamer verlaat
  entry_exit_enabled: true
  assumed_present_timeout: 60  # Seconden dat aanwezigheid wordt aangenomen na verdwijnen
  exit_threshold_pct: 50       # Percentage van entry zone afstand voor geldige exit
  occupancy_off_delay: 15      # Globale off-delay voor occupancy

  # Polygon zones met individuele off-delays
  polygon_zones:
    - zone_id: 1
      polygon: "-4000:0;4000:0;4000:6000;-4000:6000"
      zone_off_delay: 15  # Seconden voordat zone als leeg wordt gemarkeerd
    - zone_id: 2
      polygon: "-4000:0;0:0;0:3000;-4000:3000"
      zone_off_delay: 10

  # Entry zones - definieren waar personen kunnen binnenkomen/verlaten
  entry_zones:
    - zone_id: 1
      polygon: "-2000:0;2000:0;2000:1500;-2000:1500"  # Deur/ingang gebied

  # Entry lines voor people counting
  entry_lines:
    - line_id: 1
      line: "-1500:1000;1500:1000;left"

# =============================================================================
# BINARY SENSORS
# =============================================================================
binary_sensor:
  - platform: ultimatesensor_radar
    occupancy:
      name: "Occupancy"

    # Assumed present - actief wanneer target verdwijnt zonder geldige exit
    assumed_present:
      name: "Assumed Present"

    zone_occupancy:
      - zone: 1
        name: "Zone 1 Occupancy"
      - zone: 2
        name: "Zone 2 Occupancy"
      - zone: 3
        name: "Zone 3 Occupancy"
      - zone: 4
        name: "Zone 4 Occupancy"

    target_active:
      - target: 1
        name: "Target 1 Active"
      - target: 2
        name: "Target 2 Active"
      - target: 3
        name: "Target 3 Active"

    entry_line_crossed:
      - line: 1
        name: "Entry Line 1 Crossed"
      - line: 2
        name: "Entry Line 2 Crossed"

# =============================================================================
# SENSORS
# =============================================================================
sensor:
  - platform: ultimatesensor_radar
    # Target 1
    target_x:
      - target: 1
        name: "Target 1 X"
    target_y:
      - target: 1
        name: "Target 1 Y"
    target_speed:
      - target: 1
        name: "Target 1 Speed"
    target_distance:
      - target: 1
        name: "Target 1 Distance"
    target_angle:
      - target: 1
        name: "Target 1 Angle"

    # Zone target counts
    zone_target_count:
      - zone: 1
        name: "Zone 1 Target Count"
      - zone: 2
        name: "Zone 2 Target Count"
      - zone: 3
        name: "Zone 3 Target Count"
      - zone: 4
        name: "Zone 4 Target Count"

    # People counter
    people_count:
      name: "People Count"

    # Resterende tijd assumed present
    assumed_present_remaining:
      name: "Assumed Present Remaining"

# =============================================================================
# TEXT SENSORS
# =============================================================================
text_sensor:
  - platform: ultimatesensor_radar
    last_crossing_direction:
      name: "Last Crossing Direction"

# =============================================================================
# ANDERE SENSOREN (SCD41, BH1750, SGP41, SPS30)
# =============================================================================
i2c:
  sda: GPIO11
  scl: GPIO10
  scan: true

sensor:
  - platform: scd4x
    co2:
      name: "CO2"
    temperature:
      name: "Temperature"
    humidity:
      name: "Humidity"

  - platform: bh1750
    name: "Illuminance"
    address: 0x23

  - platform: sgp4x
    voc:
      name: "VOC Index"
    nox:
      name: "NOx Index"

